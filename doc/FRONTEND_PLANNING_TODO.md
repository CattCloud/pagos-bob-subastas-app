# PLANNING FRONTEND - BOB SUBASTAS
**TODO-LIST-UPDATE para Desarrollo Frontend Interactivo**

---

## **CONTEXTO Y DOCUMENTACI√ìN OBLIGATORIA**

### **üìã DOCUMENTOS DE REFERENCIA CR√çTICOS:**
- ‚úÖ [`doc/Prerequisitos.md`](./Prerequisitos.md) - Problema, objetivos, reglas RN01-RN17, flujo completo
- ‚úÖ [`doc/DocumentacionAPI.md`](./DocumentacionAPI.md) - Endpoints, contratos, ejemplos, c√≥digos de error
- ‚úÖ [`doc/CONTEXTO_FRONTEND_BACKEND.md`](./CONTEXTO_FRONTEND_BACKEND.md) - Gu√≠a principal integraci√≥n
- ‚úÖ [`doc/Arquitectura_Stack.md`](./Arquitectura_Stack.md) - Stack tecnol√≥gico y estructura carpetas
- ‚úÖ [`doc/Arquitectura Funcional.md`](./Arquitectura%20Funcional.md) - M√≥dulos funcionales y prioridad
- ‚úÖ [`doc/ColoresFrontend.md`](./ColoresFrontend.md) - Paleta colores y tipograf√≠a
- ‚úÖ [`doc/Notificaciones.md`](./Notificaciones.md) - Sistema dual notificaciones
- ‚úÖ [`doc/test`](./docTest) - Test realizados en el backend - Pueden usarse como guias para ver el comportamiento del backend

### **üìã HISTORIAS DE USUARIO (19 HU):**
- ‚úÖ HU Identificaci√≥n Cliente, Registro Pago, Validaci√≥n Pagos (Admin)
- ‚úÖ HU Gesti√≥n Subastas, COMP-01/02/03/04 (competencia externa)
- ‚úÖ HU BILL-01 (facturaci√≥n), REEM-01/02/03/04/05 (reembolsos)
- ‚úÖ HU SALDO-01 (mi saldo), TRANS-01 (historial)
- ‚úÖ HU NOT-01/02 (notificaciones cliente/admin), PEN-01 (penalidades)

---

## **PLANIFICACI√ìN FRONTEND POR FASES**

### üöÄ **FASE 1: VERIFICACI√ìN DE CONFIGURACI√ìN Y ARQUITECTURA BASE (ACTUALIZADA)**

**Objetivo:** Validar que el proyecto React est√© correctamente configurado, estructurado y conectado al backend usando `fetch`.

---

### ‚úÖ **TODO DETALLADO (VERIFICACI√ìN)**

- [ ] **1.1** Verificar que el proyecto React con Vite fue creado correctamente  
  > Confirmar que `vite.config.js`, `main.jsx` y `App.jsx` existen y que el proyecto corre con `npm run dev`.

- [ ] **1.2** Verificar instalaci√≥n de dependencias principales  
  ```bash
  npm ls react-router-dom tailwindcss react-hook-form
  npm ls @tanstack/react-query react-hot-toast react-icons
  npm ls react-dropzone
  ```
  > Validar que todas est√©n presentes en `package.json` y sin conflictos.  
  ‚úÖ **Nota:** No se usa Axios. Se usar√° `fetch` nativo.

- [ ] **1.3** Verificar configuraci√≥n de TailwindCSS con colores personalizados  
  > Confirmar que `tailwind.config.js` incluye la paleta definida en [`doc/ColoresFrontend.md`](./ColoresFrontend.md) y que `index.css` importa Tailwind correctamente.

- [ ] **1.4** Verificar estructura de carpetas seg√∫n [`doc/Arquitectura_Stack.md`](./Arquitectura_Stack.md)  
  ```bash
  tree src -L 2
  ```
  > Validar existencia de:
  ```
  src/
  ‚îú‚îÄ‚îÄ components/ (ui/, forms/, layout/, common/)
  ‚îú‚îÄ‚îÄ pages/ (client/, admin/, auth/)
  ‚îú‚îÄ‚îÄ hooks/
  ‚îú‚îÄ‚îÄ services/
  ‚îú‚îÄ‚îÄ utils/
  ‚îú‚îÄ‚îÄ constants/
  ‚îú‚îÄ‚îÄ index.css
  ```

- [ ] **1.5** Verificar que `src/index.css` contiene variables CSS seg√∫n paleta  
  > Confirmar que est√°n definidas para su uso en el codigo.

- [ ] **1.6** Verificar servicio base API (`src/services/api.js`) usando `fetch`  
  > Confirmar que se usa `fetch` para llamadas a `http://localhost:3000` con defensas como `try/catch`, headers, y manejo de errores.

- [ ] **1.7** Verificar configuraci√≥n de React Router con rutas principales  
  > Confirmar que `/pago-subastas` y `/admin-subastas` est√°n definidas en `router` y que navegan correctamente.

---

### üß™ **PUNTO DE TESTING 1**

- [ ] Proyecto ejecuta correctamente (`npm run dev`)
- [ ] Navegaci√≥n entre rutas b√°sicas funciona
- [ ] Colores Tailwind se aplican correctamente
- [ ] Conexi√≥n con API base (`GET /`) responde exitosamente usando `fetch`

---

### **üîê FASE 2: SISTEMA DE AUTENTICACI√ìN**
**Objetivo:** Implementar identificaci√≥n sin password seg√∫n RN14-RN15

**TODO DETALLADO:**
- [ ] **2.1** Crear componentes UI base (`src/components/ui/`):
  - `Button.jsx`, `Input.jsx`, `Card.jsx`, `Modal.jsx`, `Toast.jsx`
- [ ] **2.2** Implementar identificaci√≥n cliente (`src/pages/auth/ClientLogin.jsx`):
  - Formulario document_type + document_number
  - Validaci√≥n con react-hook-form
  - Conexi√≥n POST `/auth/client-login`
- [ ] **2.3** Implementar acceso admin (`src/pages/auth/AdminLogin.jsx`):
  - Acceso autom√°tico con POST `/auth/admin-access`
- [ ] **2.4** Crear context de autenticaci√≥n (`src/contexts/AuthContext.jsx`):
  - Gesti√≥n de sesi√≥n (session_id en localStorage)
  - Estado global user + session
  - Auto-renovaci√≥n de sesi√≥n
- [ ] **2.5** Implementar middleware de rutas protegidas
- [ ] **2.6** Crear layouts base (`src/components/layout/`):
  - `ClientLayout.jsx`, `AdminLayout.jsx`

**üß™ PUNTO DE TESTING 2:**
- Probar login cliente con documento v√°lido/inv√°lido
- Probar acceso admin autom√°tico
- Verificar persistencia de sesi√≥n
- Probar protecci√≥n de rutas
- Validar layouts responsive

---

### **üí∞ FASE 3: M√ìDULO SALDOS Y DASHBOARD B√ÅSICO**
**Objetivo:** Implementar f√≥rmula central: Disponible = Total - Retenido - Aplicado

**TODO DETALLADO:**
- [ ] **3.1** Crear servicio de saldos (`src/services/balanceService.js`):
  - GET `/users/:id/balance`
  - Hook personalizado `useBalance()`
- [ ] **3.2** Implementar p√°gina Mi Saldo (`src/pages/client/MyBalance.jsx`):
  - Mostrar f√≥rmula desglosada visualmente
  - Cards para cada componente del saldo
  - Enlaces r√°pidos a historial y reembolso
- [ ] **3.3** Dashboard admin b√°sico (`src/pages/admin/Dashboard.jsx`):
  - Resumen saldos todos los clientes
  - Stats b√°sicas del sistema
- [ ] **3.4** Crear componente BalanceCard reutilizable
- [ ] **3.5** Implementar formato de monedas y helpers

**üß™ PUNTO DE TESTING 3:**
- Verificar c√°lculo de saldos coincide con backend
- Probar f√≥rmula visual clara para usuario
- Validar formato correcto de monedas
- Testing responsivo en m√≥vil/desktop

---

### **üìã FASE 4: M√ìDULO TRANSACCIONES E HISTORIAL**
**Objetivo:** HU-TRANS-01 completo con filtros y detalles

**TODO DETALLADO:**
- [ ] **4.1** Crear servicio movements (`src/services/movementService.js`):
  - GET `/users/:id/movements` con filtros
  - GET `/movements/:id` para detalles
- [ ] **4.2** Implementar p√°gina Historial (`src/pages/client/TransactionHistory.jsx`):
  - Lista paginada de transacciones
  - Filtros por tipo, estado, fechas
  - B√∫squeda y ordenamiento
- [ ] **4.3** Crear componentes:
  - `TransactionCard.jsx` - Item de transacci√≥n
  - `TransactionFilters.jsx` - Panel filtros
  - `TransactionDetail.jsx` - Modal detalle
- [ ] **4.4** Implementar p√°gina Movements Admin (`src/pages/admin/MovementsManagement.jsx`):
  - Lista todos los movements
  - Acciones de aprobaci√≥n/rechazo
- [ ] **4.5** Gesti√≥n de comprobantes (vouchers):
  - Visualizaci√≥n de archivos Cloudinary
  - Descarga con GET `/movements/:id/voucher`

**üß™ PUNTO DE TESTING 4:**
- Probar filtros funcionan correctamente
- Verificar paginaci√≥n
- Probar visualizaci√≥n de comprobantes
- Testing UX de transacciones

---

### **üí≥ FASE 5: M√ìDULO PAGOS DE GARANT√çA**
**Objetivo:** HU Registro Pago completo con upload de archivos

**TODO DETALLADO:**
- [ ] **5.1** Crear formulario multi-step (`src/pages/client/PaymentRegistration.jsx`):
  - Step 1: Validaci√≥n datos cliente
  - Step 2: Selecci√≥n subasta ganada
  - Step 3: Datos pago + upload voucher
  - Step 4: Confirmaci√≥n
- [ ] **5.2** Implementar upload de archivos con react-dropzone:
  - Validaci√≥n tipos: PDF/JPG/PNG, max 5MB
  - Preview y confirmaci√≥n
  - Conexi√≥n POST `/movements` (multipart/form-data)
- [ ] **5.3** Crear componentes:
  - `PaymentForm.jsx` - Formulario pago
  - `FileUpload.jsx` - Upload voucher
  - `AuctionSelector.jsx` - Seleccionar subasta
- [ ] **5.4** Validaciones frontend:
  - Monto exacto 8% seg√∫n RN02
  - Fecha pago v√°lida
  - N√∫mero operaci√≥n √∫nico
- [ ] **5.5** Integrar con sistema de notificaciones

**üß™ PUNTO DE TESTING 5:**
- Probar upload de archivos diferentes tipos
- Verificar validaci√≥n monto 8%
- Probar formulario multi-step UX
- Testing integraci√≥n con backend

---

### **üîî FASE 6: SISTEMA DE NOTIFICACIONES**
**Objetivo:** HU-NOT-01/02 con 8 tipos de notificaciones

**TODO DETALLADO:**
- [ ] **6.1** Crear servicio notificaciones (`src/services/notificationService.js`):
  - GET `/notifications` con filtros
  - PATCH `/notifications/:id/read`
  - PATCH `/notifications/mark-all-read`
- [ ] **6.2** Implementar panel notificaciones (`src/pages/client/Notifications.jsx`):
  - Lista con estados y tipos
  - Badge contador en header
  - Marcar como le√≠das
- [ ] **6.3** Crear componentes:
  - `NotificationBadge.jsx` - Badge con contador
  - `NotificationCard.jsx` - Item notificaci√≥n
  - `NotificationPanel.jsx` - Panel lateral/modal
- [ ] **6.4** Notificaciones admin (`src/pages/admin/NotificationsAdmin.jsx`):
  - Filtros por usuario y tipo
  - Priorizaci√≥n alta/media/baja
- [ ] **6.5** Toast notifications para acciones inmediatas:
  - React Hot Toast configurado
  - Notificaciones en tiempo real

**üß™ PUNTO DE TESTING 6:**
- Probar contador badge actualiza
- Verificar filtros y estados
- Testing notificaciones tiempo real
- Probar UX panel notificaciones

---

### **üí∏ FASE 7: M√ìDULO REEMBOLSOS**
**Objetivo:** HU-REEM-01/04/05 completo con auction_id obligatorio

**TODO DETALLADO:**
- [ ] **7.1** Crear servicio reembolsos (`src/services/refundService.js`):
  - POST `/refunds` (con auction_id obligatorio)
  - GET historial reembolsos cliente
- [ ] **7.2** Implementar solicitud reembolso (`src/pages/client/RefundRequest.jsx`):
  - Formulario con auction_id, monto, tipo, motivo
  - Validaciones: saldo disponible, max 2 decimales
  - Selecci√≥n tipo: mantener_saldo vs devolver_dinero
- [ ] **7.3** Historial reembolsos (`src/pages/client/RefundHistory.jsx`):
  - Lista solicitudes con estados
  - Timeline visual del proceso
- [ ] **7.4** Detalle reembolso (`src/pages/client/RefundDetail.jsx`):
  - Informaci√≥n completa solicitud
  - Descarga comprobantes si aplica
- [ ] **7.5** Gesti√≥n admin (`src/pages/admin/RefundManagement.jsx`):
  - Lista solicitudes pendientes
  - Acciones confirmar/rechazar/procesar
  - Upload voucher para devolver_dinero

**üß™ PUNTO DE TESTING 7:**
- Probar validaci√≥n auction_id obligatorio
- Verificar tipos reembolso funcionan
- Probar flujo completo solicitado‚Üíprocesado
- Testing admin gesti√≥n reembolsos

---

### **üèÜ FASE 8: M√ìDULO SUBASTAS Y COMPETENCIA EXTERNA (ADMIN)**
**Objetivo:** HU Gesti√≥n Subastas + HU-COMP-01/02/03/04

**TODO DETALLADO:**
- [ ] **8.1** Crear servicio subastas (`src/services/auctionService.js`):
  - GET `/auctions` con filtros
  - POST `/auctions` crear nueva
  - PATCH `/auctions/:id/competition-result`
- [ ] **8.2** Gesti√≥n subastas (`src/pages/admin/AuctionManagement.jsx`):
  - Lista con filtros estado, fecha, b√∫squeda
  - Crear nueva subasta + activo
  - Registrar ganador
- [ ] **8.3** Resultados competencia (`src/pages/admin/CompetitionResults.jsx`):
  - Registrar resultado: ganada/perdida/penalizada
  - Activaci√≥n autom√°tica procesos
  - Visualizaci√≥n estados finales
- [ ] **8.4** Crear componentes:
  - `AuctionCard.jsx` - Item subasta
  - `AuctionForm.jsx` - Formulario crear
  - `WinnerAssignment.jsx` - Asignar ganador
  - `CompetitionResultForm.jsx` - Resultado competencia
- [ ] **8.5** Integrar con notificaciones autom√°ticas

**üß™ PUNTO DE TESTING 8:**
- Probar CRUD completo subastas
- Verificar asignaci√≥n ganador y c√°lculo 8%
- Probar resultados competencia externa
- Testing flujo admin completo

---

### **üßæ FASE 9: M√ìDULO FACTURACI√ìN**
**Objetivo:** HU-BILL-01 cuando BOB gana competencia

**TODO DETALLADO:**
- [ ] **9.1** Crear servicio billing (`src/services/billingService.js`):
  - POST `/billing` completar datos
- [ ] **9.2** Formulario facturaci√≥n cliente (`src/pages/client/BillingCompletion.jsx`):
  - Datos billing: document_type, document_number, name
  - Solo visible cuando subasta estado = 'ganada'
  - Mostrar impacto en saldo (retenido ‚Üí aplicado)
- [ ] **9.3** Gesti√≥n billing admin (`src/pages/admin/BillingManagement.jsx`):
  - Lista facturas generadas
  - Seguimiento saldos aplicados
- [ ] **9.4** Crear componentes:
  - `BillingForm.jsx` - Formulario datos
  - `BillingCard.jsx` - Item factura
- [ ] **9.5** Validaciones documento billing

**üß™ PUNTO DE TESTING 9:**
- Probar formulario billing cuando ganada
- Verificar impacto en saldos (retenido‚Üíaplicado)
- Testing validaciones documento
- Probar flujo completo ganada‚Üífacturada

---

### **‚öñÔ∏è FASE 10: M√ìDULO VALIDACI√ìN PAGOS (ADMIN)**
**Objetivo:** HU Validaci√≥n Pagos Admin completo

**TODO DETALLADO:**
- [ ] **10.1** Dashboard validaci√≥n (`src/pages/admin/PaymentValidation.jsx`):
  - Lista pagos pendientes priorizada
  - Visualizaci√≥n comprobantes Cloudinary
  - Acciones aprobar/rechazar
- [ ] **10.2** Detalle pago (`src/components/admin/PaymentDetail.jsx`):
  - Informaci√≥n completa movement
  - Preview voucher
  - Formulario aprobaci√≥n/rechazo
- [ ] **10.3** Componentes espec√≠ficos:
  - `PaymentCard.jsx` - Item pago pendiente
  - `VoucherViewer.jsx` - Visualizador comprobantes
  - `PaymentActions.jsx` - Acciones admin
- [ ] **10.4** Validaciones autom√°ticas:
  - Monto coincide con 8%
  - Fecha v√°lida
  - Documento legible

**üß™ PUNTO DE TESTING 10:**
- Probar workflow aprobaci√≥n/rechazo
- Verificar visualizaci√≥n comprobantes
- Testing validaciones autom√°ticas
- Probar impact en cache saldos

---

### **üéØ FASE 11: M√ìDULOS AUXILIARES Y UX**
**Objetivo:** Completar funcionalidades restantes

**TODO DETALLADO:**
- [ ] **11.1** Implementar b√∫squedas y filtros avanzados
- [ ] **11.2** Sistema de estados y indicadores visuales
- [ ] **11.3** Gesti√≥n de errores y loading states
- [ ] **11.4** Breadcrumbs y navegaci√≥n
- [ ] **11.5** Configurar React Query para cache
- [ ] **11.6** Optimizar rendimiento y lazy loading

**üß™ PUNTO DE TESTING 11:**
- Probar rendimiento con datos reales
- Testing responsive completo
- Verificar estados loading/error
- Probar navegaci√≥n UX

---

### **üîß FASE 12: INTEGRACI√ìN Y PULIMENTO**
**Objetivo:** Conectar todos los m√≥dulos y testing end-to-end

**TODO DETALLADO:**
- [ ] **12.1** Integraci√≥n completa entre m√≥dulos
- [ ] **12.2** Testing contra tests backend existentes:
  - Probar contra `flow1-bob-ganada-tests.js`
  - Probar contra `flow2-bob-perdida-refund-tests.js`
  - Probar contra `flow3-bob-penalidad-tests.js`
  - Probar contra `validaciones-negocio-tests.js`
- [ ] **12.3** Refinamiento UX/UI:
  - Feedback visual inmediato
  - Confirmaciones para acciones cr√≠ticas
  - Estados de carga y vac√≠o
- [ ] **12.4** Optimizaci√≥n final:
  - Bundle size optimization
  - Lazy loading components
  - Error boundaries
- [ ] **12.5** Documentaci√≥n de usuario final

**üß™ PUNTO DE TESTING FINAL:**
- Testing E2E completo contra backend
- Verificar todos los 19 HU funcionan
- Probar todos los flujos de tests backend
- Validaci√≥n UX con usuarios reales

---

## **CONFIGURACI√ìN T√âCNICA ESPEC√çFICA**

### **üé® COLORES TAILWIND (index.css):**
```css
@import 'tailwindcss/base';
@import 'tailwindcss/components';
@import 'tailwindcss/utilities';

@layer base {
  :root {
    /* Primarios BOB */
    --color-primary-50: #f0f9ff;
    --color-primary-100: #e0f2fe;
    --color-primary-500: #0891b2;
    --color-primary-600: #0e7490;
    --color-primary-700: #164e63;
    
    /* Secundarios */
    --color-secondary-50: #fffbeb;
    --color-secondary-100: #fef3c7;
    --color-secondary-500: #f59e0b;
    --color-secondary-600: #d97706;
    --color-secondary-700: #b45309;
    
    /* Estados */
    --color-success: #10b981;
    --color-warning: #f59e0b;
    --color-error: #ef4444;
    --color-info: #3b82f6;
  }
}

@layer components {
  .btn-primary {
    @apply bg-primary-500 hover:bg-primary-600 text-white font-semibold py-2 px-4 rounded;
  }
  
  .card-base {
    @apply bg-white shadow-md rounded-lg p-6 border border-gray-200;
  }
  
  .input-base {
    @apply w-full px-3 py-2 border border-gray-300 rounded focus:ring-primary-500 focus:border-primary-500;
  }
}
```

### **üîå API Service Base:**
```javascript
// src/services/api.js
import axios from 'axios';

const API_BASE = import.meta.env.VITE_API_URL || 'http://localhost:3000';

const apiClient = axios.create({
  baseURL: API_BASE,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Interceptor para session_id autom√°tico
apiClient.interceptors.request.use((config) => {
  const sessionId = localStorage.getItem('session_id');
  if (sessionId) {
    config.headers['X-Session-ID'] = sessionId;
  }
  return config;
});

export default apiClient;
```

### **üì± Estructura Rutas:**
```javascript
// src/App.jsx estructura propuesta
<Routes>
  <Route path="/pago-subastas" element={<ClientRoutes />}>
    <Route index element={<MyGuarantees />} />
    <Route path="balance" element={<MyBalance />} />
    <Route path="transactions" element={<TransactionHistory />} />
    <Route path="payment" element={<PaymentRegistration />} />
    <Route path="refunds" element={<RefundManagement />} />
    <Route path="notifications" element={<Notifications />} />
  </Route>
  
  <Route path="/admin-subastas" element={<AdminRoutes />}>
    <Route index element={<PaymentValidation />} />
    <Route path="auctions" element={<AuctionManagement />} />
    <Route path="competition" element={<CompetitionResults />} />
    <Route path="billing" element={<BillingManagement />} />
    <Route path="refunds" element={<RefundManagement />} />
    <Route path="balances" element={<BalanceManagement />} />
  </Route>
</Routes>
```

---

## **METODOLOG√çA DE DESARROLLO**

### **üîÑ CICLO ITERATIVO POR FASE:**
1. **Desarrollo**: Implementar TODO de la fase
2. **Testing Internal**: Verificar funciona localmente
3. **Integraci√≥n**: Conectar con backend en localhost:3000
4. **Validaci√≥n Usuario**: Presentar avance para feedback
5. **Refinamiento**: Ajustar seg√∫n feedback antes de continuar

### **üìã CRITERIOS DE VALIDACI√ìN POR FASE:**
- ‚úÖ Funcionalidad cumple HU correspondiente
- ‚úÖ UX/UI sigue paleta de ColoresFrontend.md
- ‚úÖ Responsive m√≥vil/desktop
- ‚úÖ Conecta correctamente con API backend
- ‚úÖ Manejo adecuado de errores
- ‚úÖ Performance aceptable

### **üß™ TESTING REQUIREMENTS:**
- Usar tests backend como referencia de comportamiento esperado
- Validar contra DocumentacionAPI.md contratos
- Probar todos los casos de error (validaciones-negocio-tests.js)
- Verificar f√≥rmula saldos: `Disponible = Total - Retenido - Aplicado`

---

## **SIGUIENTE PASO:**

**COMENZAR FASE 1** - Configuraci√≥n inicial y arquitectura base. Una vez completada la fase 1, presentar resultado para validaci√≥n antes de continuar con Fase 2.

**IMPORTANTE:** Cada fase requiere aprobaci√≥n expl√≠cita antes de continuar a la siguiente fase.